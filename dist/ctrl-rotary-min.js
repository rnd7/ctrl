"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var s=0;s<e.length;s++){var r=e[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,s){return e&&_defineProperties(t.prototype,e),s&&_defineProperties(t,s),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Rotary=exports.ROTARY_DEFAULTS=exports.ALWAYS=exports.COMPLETE=exports.STEP=exports.TARGET=exports.VALUE=exports.NONE=void 0;var TAU=2*Math.PI,HALF_PI=Math.PI/2;function mod(t,e){return(t%e+e)%e}function calcAngle(t,e,s,r){var i=Math.atan2(r-e,s-t);return i<0&&(i+=TAU),i}function calcAngleDelta(t,e){var s=mod(t-e,TAU),r=mod(e-t,TAU);return s<r?-s:r}function clamp(t,e,s){return Math.min(s||1,Math.max(e||0,t))}function drawTorusSegment(t,e,s,r,i,a,n){a=a||0,n=n||TAU,t.beginPath(),t.arc(e,s,r,a,n,!1),t.arc(e,s,i,n,a,!0),t.closePath()}var NONE="none";exports.NONE=NONE;var VALUE="value";exports.VALUE=VALUE;var TARGET="target";exports.TARGET=TARGET;var STEP="step";exports.STEP=STEP;var COMPLETE="complete";exports.COMPLETE=COMPLETE;var ALWAYS="always";exports.ALWAYS=ALWAYS;var ROTARY_DEFAULTS={observeSize:!1,sizeFromParent:!0,eventMode:VALUE,speed:.01,value:0,disabled:!1,neutralAngle:-HALF_PI,borderRadius:2,borderColor:"rgb(12,12,12)",borderFocusColor:"rgb(0,0,80)",backgroundColor:"rgb(36,36,36)",steps:1,stepGap:TAU/360,trackSize:12,trackSector:.8*TAU,trackSectorColor:"rgb(66,66,66)",valueSector:TAU/48,valueSectorColor:"rgb(255,255,255)",targetSector:TAU/48,targetSectorColor:"rgba(170,170,255,.5)"};exports.ROTARY_DEFAULTS=ROTARY_DEFAULTS;var Rotary=function(){function e(t){_classCallCheck(this,e),this._canvas=document.createElement("CANVAS"),this._canvas.tabIndex=0,this._canvas.style.outline=0,this._canvas.style.userSelect="none",this._ctx=this._canvas.getContext("2d"),this._target=null,this._mouseX=0,this._mouseY=0,this._mouseAngle=0,this._bound={startDrag:this.startDrag.bind(this),stopDrag:this.stopDrag.bind(this),drag:this.drag.bind(this),focus:this.focus.bind(this),blur:this.blur.bind(this)},Object.assign(this,ROTARY_DEFAULTS,t),null===this.target&&(this.target=this.value),this._canvas.addEventListener("mousedown",this._bound.startDrag),this._canvas.addEventListener("focus",this._bound.focus,!0),this._canvas.addEventListener("blur",this._bound.blur,!0)}return _createClass(e,[{key:"startDrag",value:function(t){this._disabled||(this._dragging=!0,this._canvas.removeEventListener("mousedown",this._bound.startDrag),this._canvas.removeEventListener("touchstart",this._bound.startDrag),document.addEventListener("mousemove",this._bound.drag),document.addEventListener("touchmove",this._bound.drag),document.addEventListener("mouseup",this._bound.stopDrag),document.addEventListener("mouseleave",this._bound.stopDrag),document.addEventListener("dragleave",this._bound.stopDrag),document.addEventListener("touchcancel",this._bound.stopDrag),document.addEventListener("touchend",this._bound.stopDrag),this._evalMousePosition(t))}},{key:"drag",value:function(t){this._disabled||this._evalMousePosition(t)}},{key:"stopDrag",value:function(t){this._disabled||(this._dragging=!1,document.removeEventListener("mousemove",this._bound.drag),document.removeEventListener("touchmove",this._bound.drag),document.removeEventListener("mouseup",this._bound.stopDrag),document.removeEventListener("mouseleave",this._bound.stopDrag),document.removeEventListener("dragleave",this._bound.stopDrag),document.removeEventListener("touchcancel",this._bound.stopDrag),document.removeEventListener("touchend",this._bound.stopDrag),this._canvas.addEventListener("mousedown",this._bound.startDrag),this._canvas.addEventListener("touchstart",this._bound.startDrag),this._evalMousePosition(t))}},{key:"focus",value:function(t){this._disabled||(this._focus=!0,this.redraw())}},{key:"blur",value:function(t){this._disabled||(this._focus=!1,this.redraw())}},{key:"on",value:function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];this._canvas.addEventListener.apply(this._canvas,e)}},{key:"addEventListener",value:function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];this._canvas.addEventListener.apply(this._canvas,e)}},{key:"off",value:function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];this._canvas.removeEventListener.apply(this._canvas,e)}},{key:"removeEventListener",value:function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];this._canvas.removeEventListener.apply(this._canvas,e)}},{key:"fitParent",value:function(){this._parent&&(this._width=this._parent.offsetWidth,this._height=this._parent.offsetHeight,this._resizeCanvas())}},{key:"redraw",value:function(){this._redraw=!0,this._loop()}},{key:"_resizeCanvas",value:function(){this._canvasSize=Math.min(this._width,this._height),this._radius=this._canvasSize/2,this._centerX=this._centerY=this._radius,this.redraw()}},{key:"_attachDomElement",value:function(){this.parent&&this._canvas&&(this._parent.appendChild(this._canvas),this.fitParent(),this.redraw())}},{key:"_evalMousePosition",value:function(t){this._mouseX=t.touches?t.touches[0].pageX:t.pageX,this._mouseY=t.touches?t.touches[0].pageY:t.pageY,this._mouseAngle=calcAngle(this._canvas.offsetLeft+this._canvasSize/2,this._canvas.offsetTop+this._canvasSize/2,this._mouseX,this._mouseY);var e=this._neutralAngle-Math.PI,s=(TAU-(this._trackSector-this._valueSector))/TAU,r=mod(this._mouseAngle-e,TAU)/TAU*(TAU/(this._trackSector-this._valueSector))-(s+this._valueSector/2)/2;this._target=clamp(r),this.redraw()}},{key:"_dispatchChangeEvent",value:function(){this._eventMode===NONE||this._eventMode===VALUE&&this._lastEventValue==this._value||this._eventMode===TARGET&&this._lastEventTarget==this._target||this._eventMode===STEP&&this._lastEventStep==this.step||this._eventMode===COMPLETE&&this._value!=this._target||(this._canvas.dispatchEvent(new CustomEvent("change",{bubbles:!0,detail:{step:this.step,value:this._value,target:this._target,component:this}})),this._lastEventValue=this._value,this._lastEventTarget=this._target,this._lastEventStep=this.step)}},{key:"_loop",value:function(){var e=this;!this._animationFrame&&(this._observeSize||this._dragging||this._redraw||this._value!=this._target)&&(this._animationFrame=window.requestAnimationFrame(function(){var t=e._dragging||e._redraw;e._value!=e._target&&(e.speed<=0?e._value=e._target:e._value+e._speed<=e._target?e._value+=e._speed:e._value-e._speed>=e._target?e._value-=e._speed:e._value=e._target,t=!0,e._dispatchChangeEvent()),e._observeSize&&e._sizeFromParent&&(e._parent.offsetWidth!=e._width||e._parent.offsetHeight!=e._height)&&(e.fitParent(),t=!0),e._animationFrame=null,t&&e._draw(),e._loop()}))}},{key:"_draw",value:function(){var t,e,s=this._ctx,r=this._centerX,i=this._centerY,a=this._borderRadius,n=Math.min(this._radius/3,this._trackSize),o=-this._trackSector/2+this._neutralAngle,h=o+this._trackSector,u=calcAngleDelta(o,h),c=this._target,_=this._value,l=this._radius-a,d=this._radius-a-n;if(s.canvas.width!=this._canvasSize||s.canvas.height!=this._canvasSize?s.canvas.width=s.canvas.height=this._canvasSize:s.clearRect(0,0,this._canvasSize,this._canvasSize),s.save(),s.beginPath(),s.fillStyle=this._focus?this._borderFocusColor:this._borderColor,s.arc(r,i,this._radius,0,TAU),s.arc(r,i,d-a,0,TAU,!0),s.clip(),s.fill(),s.restore(),s.fillStyle=this._backgroundColor,drawTorusSegment(s,r,i,l,d),s.fill(),this._steps<2)s.fillStyle=this._trackSectorColor,drawTorusSegment(s,r,i,l,d,o,h),s.fill(),_!=c&&(e=(t=c*(TAU+u-this._targetSector)+o)+this._targetSector,s.fillStyle=this._targetSectorColor,drawTorusSegment(s,r,i,l,d,t,e),s.fill()),e=(t=_*(TAU+u-this._valueSector)+o)+this._valueSector,s.fillStyle=this._valueSectorColor,drawTorusSegment(s,r,i,l,d,t,e),s.fill();else for(var v=this._trackSector/this._steps,g=1/this._steps,f=0;f<this._steps;f++)t=mod(o+v*f,TAU)+this._stepGap,e=mod(o+v*(f+1),TAU)-this._stepGap,s.fillStyle=this._trackSectorColor,drawTorusSegment(s,r,i,l,d,t,e),s.fill(),f*g<=_&&_<=(f+1)*g?(s.fillStyle=this._valueSectorColor,drawTorusSegment(s,r,i,l,d,t,e),s.fill()):_!=c&&f*g<=c&&c<=(f+1)*g&&(s.fillStyle=this._targetSectorColor,drawTorusSegment(s,r,i,l,d,t,e),s.fill());this._redraw=!1}},{key:"eventMode",set:function(t){this._eventMode=t},get:function(){return this._eventMode}},{key:"selector",set:function(t){this._selector=t,this.parent=document.querySelector(this._selector)},get:function(){return this._selector}},{key:"parent",set:function(t){this._parent=t,this._attachDomElement()},get:function(){return this._parent}},{key:"value",set:function(t){this._value!=t&&(this._value=clamp(t),this.redraw())},get:function(){return this._value}},{key:"trackSector",set:function(t){this._trackSector!=t&&(this._trackSector=t,this.redraw())},get:function(){return this._trackSector}},{key:"target",set:function(t){this._target!=t&&(this._target=clamp(t),this.redraw())},get:function(){return this._target}},{key:"steps",set:function(t){this._steps!=t&&(this._steps=Math.max(1,t),this.redraw())},get:function(){return this._steps}},{key:"step",get:function(){return Math.floor(this._value*this._steps)},set:function(t){this.value=t/this._steps}},{key:"neutralAngle",set:function(t){this._neutralAngle!=t&&(this._neutralAngle=t,this.redraw())},get:function(){return this._neutralAngle}},{key:"sizeFromParent",set:function(t){this._sizeFromParent!=t&&(this._sizeFromParent=t,this._sizeFromParent&&this.fitParent())},get:function(){return this._sizeFromParent}},{key:"width",set:function(t){this._width!=t&&(this._width=t,this._resizeCanvas())},get:function(){return this._width}},{key:"height",set:function(t){this._height!=t&&(this._height=t,this._resizeCanvas())},get:function(){return this._height}},{key:"speed",set:function(t){this._speed!=t&&(this._speed=t)},get:function(){return this._speed}},{key:"targetSector",set:function(t){this._targetSector!=t&&(this._targetSector=t,this.redraw())},get:function(){return this._targetSector}},{key:"valueSector",set:function(t){this._valueSector!=t&&(this._valueSector=t,this.redraw())},get:function(){return this._valueSector}},{key:"stepGap",set:function(t){this._stepGap!=t&&(this._stepGap=t,this.redraw())},get:function(){return this._stepGap}},{key:"disabled",set:function(t){this._disabled!=t&&(this._disabled=t,this._disabled&&this._dragging&&this.stopDrag(),this._disabled&&this._focus&&this.blur(),this.redraw())},get:function(){return this._disabled}},{key:"observeSize",set:function(t){this._observeSize!=t&&(this._observeSize=t,this._observeSize&&this._loop())},get:function(){return observeSize}},{key:"borderRadius",set:function(t){this._borderRadius!=t&&(this._borderRadius=t,this.redraw())},get:function(){return this._borderRadius}},{key:"trackSize",set:function(t){this._trackSize!=t&&(this._trackSize=t,this.redraw())},get:function(){return this._trackSize}},{key:"valueSectorColor",set:function(t){this._valueSectorColor!=t&&(this._valueSectorColor=t,this.redraw())},get:function(){return this._valueSectorColor}},{key:"trackSectorColor",set:function(t){this._trackSectorColor!=t&&(this._trackSectorColor=t,this.redraw())},get:function(){return this._trackSectorColor}},{key:"borderColor",set:function(t){this._borderColor!=t&&(this._borderColor=t,this.redraw())},get:function(){return this._borderColor}},{key:"borderFocusColor",set:function(t){this._borderFocusColor!=t&&(this._borderFocusColor=t,this.redraw())},get:function(){return this._borderFocusColor}},{key:"backgroundColor",set:function(t){this._backgroundColor!=t&&(this._backgroundColor=t,this.redraw())},get:function(){return this._backgroundColor}},{key:"targetSectorColor",set:function(t){this._targetSectorColor!=t&&(this._targetSectorColor=t,this.redraw())},get:function(){return this._targetSectorColor}},{key:"domElement",get:function(){return this._canvas}}]),e}();exports.Rotary=Rotary;
//# sourceMappingURL=ctrl-rotary-min.js.map
